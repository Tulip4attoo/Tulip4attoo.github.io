<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Tạo bot chơi T-Rex trong Chrome (phần 1) - Hardcode version</title>

    <meta name="viewport" content="width=device-width">
    <meta name="description" content="">

    
    

    <link rel="canonical" href="http://localhost:4000/tao-bot-choi-dinosaur-chrome-1/">
    <link rel="icon" type="image/png" href="/images/logo.png">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/monster.css">

    <!-- MathJax Configuration -->
    
    <script>
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$']],
          displayMath: [['\\[', '\\]']],
          processEscapes: true,
          processEnvironments: true,
          tags: 'ams'
        },
        options: {
          skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
          processHtmlClass: 'tex2jax_process'
        },
        startup: {
          ready: function() {
            MathJax.startup.defaultReady();
          }
        }
      };
    </script>
    <script type="text/javascript" id="MathJax-script" async
      src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
    </script>
    

    

</head>


    <body>
    
    <div class="wrapper">

      <header class="header">

  <div class="site-title">
    
    <h4 class="entry-title"><a href="/tao-bot-choi-dinosaur-chrome-1/">Tạo bot chơi T-Rex trong Chrome (phần 1) - Hardcode version</a></h4>
    
  </div>

<div class="links">
    
    <a href="/" class="page-link">Blog</a>
    
    
    
    
      <a class="page-link"
        href="/about/">About</a>
    
    
    
      <a class="page-link"
        href="/categories/">Categories</a>
    
    
    
    
    
    
    
    
    <a href="/feed.xml" target="_blank" class="page-link">RSS</a>
</div>
</header>

      
      <div class="navi">
    
    <a href="/" class="page-link">Blog</a>
    <a href="/about/" class="page-link">About</a>
    <a href="/categories/" class="page-link">Categories</a>
</div>


      <div class="content">
        <div class="articles">
            <div class="entry post">

	<div class="entry-content">
	  <article class="entry-body">
	  	
	  		<p>Có thể bạn đã biết, trình duyệt Google Chrome được tích hợp sẵn một game nhỏ để bạn có thể giết thời gian mỗi khi mất mạng. Nếu bạn truy cập một trang web bằng Chrome mà mất mạng, bạn sẽ nhìn thấy hình ảnh một chú khủng long khá dễ thương hiện ra. Cách chơi game rất đơn giản: bạn bấm phím “Space”/”Up” để nhảy tránh chướng ngại vật, là cây xương rồng hoặc những con khủng long bay.</p>

<p align="center">
  <img src="../assets/img/chrome-trex/chrome_trex_intro.gif" /><br />
  <i>Trò chơi nhỏ của Chrome giúp bạn giết thời gian khi mất mạng (nguồn: https://mathewsachin.github.io)</i>
</p>

<p>Mình sẽ viết 1 series bài về cách tạo ra 1 con bot chơi game này. Hiện tại mình đã giải quyết bài toán với 2 phương pháp:</p>

<ul>
  <li>
    <p>hardcode</p>
  </li>
  <li>
    <p>sử dụng Genetic Algorithm trong 1 neural network để giải quyết bài toán</p>
  </li>
</ul>

<p>Nếu có thời gian, mình sẽ tìm cách sử dụng reinforcement learning làm cách thứ 3 giải quyết bài toán này. Để ổn định, chúng ta sẽ chơi trên 1 trang web khác thay vì chơi trên Chrome đã ngắt mạng. Mình chọn trang này: http://www.trex-game.skipser.com/ Trong bài viết này, mình sẽ nói về cách giải quyết bằng phương pháp hardcode.</p>

<h1 id="phương-pháp-hardcode">Phương pháp hardcode</h1>

<p>Ý tưởng của phương pháp này rất đơn giản: chúng ta sẽ liên tục check khoảng phía trước của con khủng long, nếu xuất hiện vật thể lạ thì khủng long sẽ nhảy lên. Về cơ bản thì đây chính là cách chúng ta chơi trò này ban đầu.</p>

<h2 id="thiết-lập-ban-đầu">Thiết lập ban đầu</h2>

<p>Trước hết chúng ta cần import các package cần thiết. Chúng ta sẽ dùng  <code class="language-plaintext highlighter-rouge">mss</code> để chụp màn hình, <code class="language-plaintext highlighter-rouge">pyautogui</code> để output ra ngoài và vài package quen thuộc khác.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">pyautogui</span>
<span class="kn">import</span> <span class="n">time</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">import</span> <span class="n">cv2</span>

<span class="kn">from</span> <span class="n">mss</span> <span class="kn">import</span> <span class="n">mss</span>
</code></pre></div></div>

<p>Chúng ta sẽ define ra 1 số constant dùng sau này:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">TIME_BETWEEN_FRAMES</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">TIME_BETWEEN_GAMES</span> <span class="o">=</span> <span class="mf">0.5</span>
</code></pre></div></div>

<p>Chúng ta tạo ra các hàm để chơi game, bao gồm: 1 class <code class="language-plaintext highlighter-rouge">Cordinates</code> để lưu vị trí của các object, và 2 hàm để restart game cũng như press phím Up.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Cordinates</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="c1"># vi tri cua cac object
</span>    <span class="n">replay_pos</span> <span class="o">=</span> <span class="p">(</span><span class="mi">390</span><span class="p">,</span> <span class="mi">410</span><span class="p">)</span> <span class="c1"># vi tri cua button replay
</span>    <span class="c1"># replay_pos = (520, 390)
</span>
<span class="k">def</span> <span class="nf">restart_game</span><span class="p">():</span>
    <span class="n">pyautogui</span><span class="p">.</span><span class="nf">click</span><span class="p">(</span><span class="n">Cordinates</span><span class="p">.</span><span class="n">replay_pos</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">press_up</span><span class="p">():</span>
    <span class="n">pyautogui</span><span class="p">.</span><span class="nf">keyDown</span><span class="p">(</span><span class="sh">"</span><span class="s">up</span><span class="sh">"</span><span class="p">)</span> <span class="c1"># press a key down
</span>    <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="mf">0.02</span><span class="p">)</span>
    <span class="c1"># print("Jump")
</span>    <span class="n">pyautogui</span><span class="p">.</span><span class="nf">keyUp</span><span class="p">(</span><span class="sh">"</span><span class="s">up</span><span class="sh">"</span><span class="p">)</span> <span class="c1"># release a key
</span></code></pre></div></div>

<h2 id="nhận-diện-vật-thể">Nhận diện vật thể</h2>

<p>Chúng ta tạo ra hàm <code class="language-plaintext highlighter-rouge">get_cactus_box_value</code> để xem xét trong 1 khu vực phía trước của khủng long (mà ở đây ta gọi là <code class="language-plaintext highlighter-rouge">cactus_box</code>) có xuất hiện vật cản hay không. Chúng ta sẽ chuyển giá trị khu vực <code class="language-plaintext highlighter-rouge">cactus_box</code> về dạng gray và lưu giá trị lại, để có thể so sánh với giá trị <code class="language-plaintext highlighter-rouge">BLANK_BOX</code> của khu vực đó khi không có vật cản.</p>

<p>Các bạn chú ý là các giá trị ở đây sẽ thay đổi tuỳ theo từng thiết lập các máy, nếu bạn muốn chạy ở máy mình thì có thể phải sửa 1 chút nha.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">BLANK_BOX</span> <span class="o">=</span> <span class="mi">247000</span>

<span class="k">def</span> <span class="nf">get_cactus_box_value</span><span class="p">():</span>
    <span class="n">cactus_box</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">left</span><span class="sh">'</span><span class="p">:</span> <span class="mi">270</span><span class="p">,</span> <span class="sh">'</span><span class="s">top</span><span class="sh">'</span><span class="p">:</span> <span class="mi">420</span><span class="p">,</span> 
                  <span class="sh">'</span><span class="s">width</span><span class="sh">'</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span> <span class="sh">'</span><span class="s">height</span><span class="sh">'</span><span class="p">:</span> <span class="mi">20</span><span class="p">}</span>
    <span class="c1"># cactus_box = {'left': 370, 'top': 400, 
</span>    <span class="c1">#               'width': 50, 'height': 20}
</span>    <span class="n">sct</span> <span class="o">=</span> <span class="nf">mss</span><span class="p">()</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">sct</span><span class="p">.</span><span class="nf">grab</span><span class="p">(</span><span class="n">cactus_box</span><span class="p">))[:,:,:</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">gray</span><span class="p">.</span><span class="nf">sum</span><span class="p">()</span>
</code></pre></div></div>

<p>Tới đây chúng ta đã cơ bản hoàn thành phần code cho 1 lượt chơi. Tuy nhiên, chúng ta nên làm thêm 1 hàm <code class="language-plaintext highlighter-rouge">check_gameover</code>, để khi có gameover thì chúng ta sẽ phát hiện ra và gọi hàm <code class="language-plaintext highlighter-rouge">restart_game</code> để chơi lại.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">GAMEOVER_RANGE</span> <span class="o">=</span> <span class="p">[</span><span class="mi">620000</span><span class="p">,</span> <span class="mi">660000</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">check_gameover</span><span class="p">(</span><span class="n">gameover_range</span> <span class="o">=</span> <span class="n">GAMEOVER_RANGE</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">gameover_box</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">left</span><span class="sh">'</span><span class="p">:</span> <span class="mi">290</span><span class="p">,</span> <span class="sh">'</span><span class="s">top</span><span class="sh">'</span><span class="p">:</span> <span class="mi">360</span><span class="p">,</span> 
                  <span class="sh">'</span><span class="s">width</span><span class="sh">'</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="sh">'</span><span class="s">height</span><span class="sh">'</span><span class="p">:</span> <span class="mi">15</span><span class="p">}</span>
    <span class="c1"># gameover_box = {'left': 430, 'top': 345, 
</span>    <span class="c1">#               'width': 200, 'height': 15}
</span>    <span class="n">sct</span> <span class="o">=</span> <span class="nf">mss</span><span class="p">()</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">(</span><span class="n">sct</span><span class="p">.</span><span class="nf">grab</span><span class="p">(</span><span class="n">gameover_box</span><span class="p">))[:,:,:</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">gray</span> <span class="o">=</span> <span class="n">cv2</span><span class="p">.</span><span class="nf">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="p">.</span><span class="n">COLOR_BGR2GRAY</span><span class="p">)</span>
    <span class="n">curr_state</span> <span class="o">=</span> <span class="n">gray</span><span class="p">.</span><span class="nf">sum</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">curr_state</span> <span class="o">&lt;</span> <span class="n">GAMEOVER_RANGE</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">curr_state</span> <span class="o">&gt;</span> <span class="n">GAMEOVER_RANGE</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></div>

<p>Sau khi đã chuẩn bị xong toàn bộ các thành phần phía trên, chúng ta sẽ tạo ra hàm <code class="language-plaintext highlighter-rouge">main</code> để kết hợp toàn bộ những thành phần ở trên lại.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="n">gameover_state</span> <span class="o">=</span> <span class="nf">check_gameover</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">gameover_state</span><span class="p">:</span>
            <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="n">TIME_BETWEEN_GAMES</span><span class="p">)</span>
            <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">Game over. Restart game</span><span class="sh">"</span><span class="p">)</span>
            <span class="nf">restart_game</span><span class="p">()</span>
        <span class="n">cactus_state</span> <span class="o">=</span> <span class="nf">get_cactus_box_value</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cactus_state</span> <span class="o">!=</span> <span class="n">BLANK_BOX</span><span class="p">:</span>
            <span class="nf">press_up</span><span class="p">()</span>
        <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="n">TIME_BETWEEN_FRAMES</span><span class="p">)</span>
</code></pre></div></div>

<h1 id="thiết-lập-hệ-thống">Thiết lập hệ thống</h1>

<p>Môi trường của hệ thống là ubuntu 16.04, xài chrome.</p>

<ul>
  <li>
    <p>Bước 1: bật trình duyệt và truy cập: http://www.trex-game.skipser.com/, khởi động game.</p>
  </li>
  <li>
    <p>Bước 2: chia đôi màn hình bằng cách gõ <code class="language-plaintext highlighter-rouge">Ctrl + Super + Left/Right</code></p>
  </li>
  <li>
    <p>Bước 3: chạy file chrome_trex_api.py</p>
  </li>
  <li>
    <p>Bước 4: quay clip lại và mang đi khoe :v</p>
  </li>
</ul>

<p>Các bạn có thể lấy file <code class="language-plaintext highlighter-rouge">chrome_trex_api.py</code> ở <a href="https://github.com/Tulip4attoo/chrome_trex/blob/master/chrome_trex_api.py">đây</a></p>

<h1 id="kết-quả">Kết quả</h1>

<p>Tada, và đây là kết quả của chúng ta. Khá tốt phải không nào?</p>

<p align="center">
  <img src="../assets/img/chrome-trex/chrome_trex_hardcode.gif" /><br />
  <i>Chạy file thôi \m/</i>
</p>

<p>Ở những bài viết sau mình sẽ giới thiệu về Genetic Algorithms và cách áp dụng nó để tạo bot học cách chơi game này.</p>

  		
	  </article>
    </div>

</div>

<div class="article-meta">
    2018-04-11
     • Category: 
        
        <a href="/categories//#bot-ref" >Bot</a>
        
        <a href="/categories//#TRex Chrome-ref" >Trex chrome</a>
        
        <a href="/categories//#GA-ref" >Ga</a>
        
    
     • Tag: 
        
    
</div>



	<div class="article-author">
    <div class="avatar">
    <img width="50" height="50" src="/assets/img/tulip4attoo.jpg" alt=" Avatar"/>
    </div>
    <div class="name">
        <h4><b>Tulip4attoo</b> </h4>
        Just for fun!
    </div>
</div>


	
	    <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'tulip4attoo-github-io';
	(function() {
	    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	    dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
	    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

	


<div class="cnzz"><script src="http://s4.cnzz.com/z_stat.php?id=1255123325&web_id=1255123325" language="JavaScript"></script> </div>


        </div>
      </div>
    </div>

    <div class="subscription-form" style="display: none;">
  <h3>Subscribe to my newsletter</h3>
  <form id="subscription-form" action="https://formspree.io/f/mgvalbyj" method="POST">
    <input type="email" name="email" placeholder="Enter your email" required>
    <button type="submit">Subscribe</button>
  </form>
  <div id="thank-you-message" style="display: none;">
    Thank you for subscribing!
  </div>
</div>

<style>
  .subscription-form {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    padding: 2rem;
    background: #f5f5f5;
    border-radius: 8px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    z-index: 1000;
    max-width: 400px;
    width: 90%;
  }
  .subscription-form h3 {
    margin-bottom: 1rem;
    text-align: center;
  }
  .subscription-form input[type="email"] {
    width: 100%;
    padding: 0.5rem;
    margin-bottom: 1rem;
    border: 1px solid #ddd;
    border-radius: 4px;
  }
  .subscription-form button {
    width: 100%;
    padding: 0.5rem 1rem;
    background: #333;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }
  .subscription-form button:hover {
    background: #444;
  }
  #thank-you-message {
    text-align: center;
    margin-top: 1rem;
    color: #28a745;
    font-weight: bold;
  }
  .overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 999;
  }
</style>

<div class="overlay" id="overlay"></div>

<script>
  function showSubscriptionForm() {
    // Check if user has already subscribed
    const hasSubscribed = sessionStorage.getItem('hasSubscribed');
    
    if (!hasSubscribed) {
      document.getElementById('overlay').style.display = 'block';
      document.querySelector('.subscription-form').style.display = 'block';
    }
  }

  function hideSubscriptionForm() {
    document.getElementById('overlay').style.display = 'none';
    document.querySelector('.subscription-form').style.display = 'none';
  }

  // Show form after 2 seconds
  setTimeout(showSubscriptionForm, 2000);

  // Close form when clicking overlay
  document.getElementById('overlay').addEventListener('click', hideSubscriptionForm);

  document.getElementById('subscription-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const form = this;
    const thankYouMessage = document.getElementById('thank-you-message');
    
    fetch(form.action, {
      method: 'POST',
      body: new FormData(form),
      headers: {
        'Accept': 'application/json'
      }
    })
    .then(response => {
      if (response.ok) {
        // Store that user has subscribed
        sessionStorage.setItem('hasSubscribed', 'true');
        form.style.display = 'none';
        thankYouMessage.style.display = 'block';
        setTimeout(() => {
          hideSubscriptionForm();
        }, 1000);
      }
    })
    .catch(error => {
      console.error('Error:', error);
    });
  });
</script> 
    <footer class="site-footer">
  <div class="wrap">
    <div class="footer-content">
      <p>© 2025 Tulip4attoo. All rights reserved.</p>
      
      <p><a href="https://github.com/tulip4attoo">GitHub</a></p>
      
    </div>
  </div>
</footer>

    </body>
</html>
